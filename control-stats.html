<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Control - Match Statistics</title>
    <style> body { overflow: hidden; } </style>
</head>
<body class="min-h-screen text-white bg-gray-900">
    <div class="flex flex-col h-screen">
        <div class="flex items-center justify-between px-4 py-3 bg-gray-800 border-b border-gray-700">
            <h1 class="text-lg font-semibold">Match Statistics Control</h1>
            <div class="space-x-2 text-sm">
                <a href="index.html" class="px-3 py-1 bg-gray-700 rounded hover:bg-gray-600">Home</a>
                <a href="control.html" class="px-3 py-1 bg-blue-600 rounded hover:bg-blue-700">All Controls</a>
                <a href="viewers.html" class="px-3 py-1 bg-gray-700 rounded hover:bg-gray-600">Viewers</a>
            </div>
        </div>

        <div class="flex-1 overflow-y-auto p-6">
            <div class="max-w-4xl mx-auto space-y-6">
                <!-- Background Image Upload -->
                <div class="bg-gray-800 rounded-lg p-6">
                    <h2 class="text-xl font-semibold mb-4">Background Image</h2>
                    <div class="mb-4">
                        <label class="block mb-2 text-sm font-medium">Upload Background Image</label>
                        <div class="p-6 text-center transition-colors border-2 border-gray-600 border-dashed rounded-lg hover:border-blue-500">
                            <input type="file" id="background-upload" accept="image/*" class="hidden">
                            <button id="background-btn" class="px-4 py-2 transition-colors bg-blue-600 rounded-lg hover:bg-blue-700">Choose Background</button>
                            <p class="mt-2 text-sm text-gray-400">PNG, JPG up to 10MB</p>
                        </div>
                    </div>
                    <div id="background-preview" class="hidden mb-4">
                        <label class="block mb-2 text-sm font-medium">Preview</label>
                        <div class="p-4 bg-gray-700 rounded-lg">
                            <img id="background-preview-img" class="h-32 w-auto mx-auto rounded" alt="Background Preview">
                        </div>
                    </div>
                </div>

                <!-- Team 1 Settings -->
                <div class="bg-gray-800 rounded-lg p-6">
                    <h2 class="text-xl font-semibold mb-4 text-red-400">Team 1 Settings</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block mb-2 text-sm font-medium">Team Name</label>
                            <input type="text" id="team1-name" value="TEAM 1" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-red-500 focus:outline-none">
                        </div>
                        <div>
                            <label class="block mb-2 text-sm font-medium">Result Text</label>
                            <select id="team1-result" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-red-500 focus:outline-none">
                                <option value="DEFEAT">DEFEAT</option>
                                <option value="VICTORY">VICTORY</option>
                            </select>
                        </div>
                        <div>
                            <label class="block mb-2 text-sm font-medium">Team Score</label>
                            <input type="number" id="team1-score" value="0" min="0" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-red-500 focus:outline-none">
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="block mb-1 text-sm font-medium">Banner Background</label>
                                <input type="color" id="team1-bg-color" value="#2563eb" class="w-full h-12 border border-gray-700 rounded">
                            </div>
                            <div>
                                <label class="block mb-1 text-sm font-medium">Banner Text</label>
                                <input type="color" id="team1-text-color" value="#ffffff" class="w-full h-12 border border-gray-700 rounded">
                            </div>
                        </div>
                        <div>
                            <label class="block mb-2 text-sm font-medium">Team Logo</label>
                            <div class="p-4 text-center transition-colors border-2 border-gray-600 border-dashed rounded-lg hover:border-red-500">
                                <input type="file" id="team1-logo-upload" accept="image/*" class="hidden">
                                <button id="team1-logo-btn" class="px-4 py-2 transition-colors bg-red-600 rounded-lg hover:bg-red-700">Upload Logo</button>
                                <p class="mt-2 text-sm text-gray-400">PNG, JPG up to 5MB</p>
                            </div>
                        </div>
                    </div>
                    <div id="team1-logo-preview" class="hidden mt-4">
                        <label class="block mb-2 text-sm font-medium">Logo Preview</label>
                        <div class="p-4 bg-gray-700 rounded-lg">
                            <img id="team1-logo-preview-img" class="h-16 w-16 mx-auto rounded" alt="Team 1 Logo Preview">
                        </div>
                    </div>
                </div>

                <!-- Team 2 Settings -->
                <div class="bg-gray-800 rounded-lg p-6">
                    <h2 class="text-xl font-semibold mb-4 text-green-400">Team 2 Settings</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block mb-2 text-sm font-medium">Team Name</label>
                            <input type="text" id="team2-name" value="TEAM 2" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-green-500 focus:outline-none">
                        </div>
                        <div>
                            <label class="block mb-2 text-sm font-medium">Result Text</label>
                            <select id="team2-result" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-green-500 focus:outline-none">
                                <option value="VICTORY">VICTORY</option>
                                <option value="DEFEAT">DEFEAT</option>
                            </select>
                        </div>
                        <div>
                            <label class="block mb-2 text-sm font-medium">Team Score</label>
                            <input type="number" id="team2-score" value="0" min="0" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-green-500 focus:outline-none">
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="block mb-1 text-sm font-medium">Banner Background</label>
                                <input type="color" id="team2-bg-color" value="#dc2626" class="w-full h-12 border border-gray-700 rounded">
                            </div>
                            <div>
                                <label class="block mb-1 text-sm font-medium">Banner Text</label>
                                <input type="color" id="team2-text-color" value="#ffffff" class="w-full h-12 border border-gray-700 rounded">
                            </div>
                        </div>
                        <div>
                            <label class="block mb-2 text-sm font-medium">Team Logo</label>
                            <div class="p-4 text-center transition-colors border-2 border-gray-600 border-dashed rounded-lg hover:border-green-500">
                                <input type="file" id="team2-logo-upload" accept="image/*" class="hidden">
                                <button id="team2-logo-btn" class="px-4 py-2 transition-colors bg-green-600 rounded-lg hover:bg-green-700">Upload Logo</button>
                                <p class="mt-2 text-sm text-gray-400">PNG, JPG up to 5MB</p>
                            </div>
                        </div>
                    </div>
                    <div id="team2-logo-preview" class="hidden mt-4">
                        <label class="block mb-2 text-sm font-medium">Logo Preview</label>
                        <div class="p-4 bg-gray-700 rounded-lg">
                            <img id="team2-logo-preview-img" class="h-16 w-16 mx-auto rounded" alt="Team 2 Logo Preview">
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex gap-4">
                    <button id="send-to-viewer" class="flex-1 px-6 py-3 transition-colors bg-green-600 rounded-lg hover:bg-green-700 font-semibold">Send to Viewer</button>
                    <button id="clear-all" class="flex-1 px-6 py-3 transition-colors bg-red-600 rounded-lg hover:bg-red-700 font-semibold">Clear All</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const channel = (typeof BroadcastChannel !== 'undefined') ? new BroadcastChannel('codm-stream') : null;
        
        // Background image elements
        const backgroundBtn = document.getElementById('background-btn');
        const backgroundInput = document.getElementById('background-upload');
        const backgroundPreview = document.getElementById('background-preview');
        const backgroundPreviewImg = document.getElementById('background-preview-img');
        
        // Team 1 elements
        const team1Name = document.getElementById('team1-name');
        const team1Result = document.getElementById('team1-result');
        const team1Score = document.getElementById('team1-score');
        const team1BgColor = document.getElementById('team1-bg-color');
        const team1TextColor = document.getElementById('team1-text-color');
        const team1LogoBtn = document.getElementById('team1-logo-btn');
        const team1LogoInput = document.getElementById('team1-logo-upload');
        const team1LogoPreview = document.getElementById('team1-logo-preview');
        const team1LogoPreviewImg = document.getElementById('team1-logo-preview-img');
        
        // Team 2 elements
        const team2Name = document.getElementById('team2-name');
        const team2Result = document.getElementById('team2-result');
        const team2Score = document.getElementById('team2-score');
        const team2BgColor = document.getElementById('team2-bg-color');
        const team2TextColor = document.getElementById('team2-text-color');
        const team2LogoBtn = document.getElementById('team2-logo-btn');
        const team2LogoInput = document.getElementById('team2-logo-upload');
        const team2LogoPreview = document.getElementById('team2-logo-preview');
        const team2LogoPreviewImg = document.getElementById('team2-logo-preview-img');
        
        
        // Action buttons
        const sendBtn = document.getElementById('send-to-viewer');
        const clearBtn = document.getElementById('clear-all');
        
        // Data storage
        let currentData = {
            image: null,
            team1Logo: null,
            team2Logo: null
        };

        // Background image upload
        backgroundBtn.addEventListener('click', () => backgroundInput.click());
        backgroundInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                currentData.image = ev.target.result;
                backgroundPreviewImg.src = currentData.image;
                backgroundPreview.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        });

        // Team 1 logo upload
        team1LogoBtn.addEventListener('click', () => team1LogoInput.click());
        team1LogoInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                currentData.team1Logo = ev.target.result;
                team1LogoPreviewImg.src = currentData.team1Logo;
                team1LogoPreview.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        });

        // Team 2 logo upload
        team2LogoBtn.addEventListener('click', () => team2LogoInput.click());
        team2LogoInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                currentData.team2Logo = ev.target.result;
                team2LogoPreviewImg.src = currentData.team2Logo;
                team2LogoPreview.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        });

        function broadcast(payload) {
            if (channel) channel.postMessage(payload);
            try {
                localStorage.setItem('codm-stream-message', JSON.stringify(payload));
                localStorage.setItem('codm-stream-last', JSON.stringify(payload));
            } catch {}
        }

        sendBtn.addEventListener('click', () => {
            const payload = {
                type: 'match-stats',
                ts: Date.now(),
                image: currentData.image,
                team1Name: team1Name.value,
                team1Result: team1Result.value,
                team1Score: parseInt(team1Score.value) || 0,
                team1BgColor: team1BgColor.value,
                team1TextColor: team1TextColor.value,
                team1Logo: currentData.team1Logo,
                team2Name: team2Name.value,
                team2Result: team2Result.value,
                team2Score: parseInt(team2Score.value) || 0,
                team2BgColor: team2BgColor.value,
                team2TextColor: team2TextColor.value,
                team2Logo: currentData.team2Logo
            };
            broadcast(payload);
        });

        clearBtn.addEventListener('click', () => {
            // Reset all form values
            team1Name.value = 'TEAM 1';
            team1Result.value = 'DEFEAT';
            team1Score.value = '0';
            team1BgColor.value = '#2563eb';
            team1TextColor.value = '#ffffff';
            team2Name.value = 'TEAM 2';
            team2Result.value = 'VICTORY';
            team2Score.value = '0';
            team2BgColor.value = '#dc2626';
            team2TextColor.value = '#ffffff';
            
            // Clear file inputs
            backgroundInput.value = '';
            team1LogoInput.value = '';
            team2LogoInput.value = '';
            
            // Hide previews
            backgroundPreview.classList.add('hidden');
            team1LogoPreview.classList.add('hidden');
            team2LogoPreview.classList.add('hidden');
            
            // Reset data
            currentData = { image: null, team1Logo: null, team2Logo: null };
            
            // Broadcast clear
            broadcast({ type: 'clear', ts: Date.now() });
        });
    </script>
</body>
</html>